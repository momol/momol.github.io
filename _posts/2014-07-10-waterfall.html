---
layout: default
title: 瀑布流布局js
---
<style>
	*{padding: 0;margin: 0;}
	#main{position: relative;}
	.box{padding-top: 15px;padding-left: 15px;float: left;}
	.pic{padding: 10px;border: 1px solid #fff;box-shadow: 0 0 1px rgb(0,0,0);border-radius: 5px;}
	.pic img{width: 165px;height: auto;}
</style>
<script>
	window.onload=function () {
		waterfall('main','box');
		var dataInt={"data":[
		{"src":'0.jpg'},
		{"src":'1.jpg'},
		{"src":'2.jpg'},
		{"src":'3.jpg'},
		{"src":'5.jpg'},
		{"src":'6.jpg'},
		{"src":'7.jpg'},
		{"src":'8.jpg'},
		]}
		window.onscroll=function(){
			if(checkScrollSlide()){
				var oParent=document.getElementById('main');
				for(var i=0;i<dataInt.data.length;i++){
					var oBox=document.createElement('div');
					var oPic=document.createElement('div');
					var oImg=document.createElement('img');
					oBox.className='box';
					oPic.className='pic';
					oImg.src='/mod/pinterest/javascript/images/'+dataInt.data[i].src;
					oParent.appendChild(oBox);
					oBox.appendChild(oPic);
					oPic.appendChild(oImg);
				}
				waterfall('main','box');
			}
		}
	}
	function waterfall(parent,box){
		var oParent=document.getElementById(parent);
		var oBoxs=getByClass(oParent,box);

		var oBoxW=oBoxs[0].offsetWidth;
		var cols=Math.floor(document.documentElement.clientWidth/oBoxW);

		oParent.style.cssText='width:'+oBoxW*cols+'px;margin:0 auto';
		//存放每列高度
		var hArr=[];
		for(var i=0;i<oBoxs.length;i++){
			if(i<cols){
				hArr.push(oBoxs[i].offsetHeight);
			}else{
				var minH=Math.min.apply(null,hArr);//最小值
				var index=getMinhIndex(hArr,minH);
				oBoxs[i].style.position='absolute';
				oBoxs[i].style.top=minH+'px';
				// oBoxs[i].style.left=oBoxW*index+'px';
				oBoxs[i].style.left=oBoxs[index].offsetLeft+'px';
				hArr[index]+=oBoxs[i].offsetHeight;
			}
		}


	}
	function getByClass(parent,clsName){
		var boxArr=new Array(),
				oElements=parent.getElementsByTagName('*');
		for(var i=0;i<oElements.length;i++){
			if(oElements[i].className==clsName){
				boxArr.push(oElements[i]);
			}
		}
		return boxArr;
	}
	//获取最小高度索引
	function getMinhIndex(arr,val){
		for(var i=0;i<arr.length;i++){
			if(arr[i]==val){
				return i;
			}
		}
	}
	//检测数据块加载条件
	function checkScrollSlide(){
		var oParent=document.getElementById('main');
		var oBoxs=getByClass(oParent,'box');
		var lastBoxH=oBoxs[oBoxs.length-1].offsetTop+Math.floor(oBoxs[oBoxs.length-1].offsetHeight/2);
		var scrollTop=document.body.scrollTop||document.documentElement.scrollTop;
		var winH=document.body.clientHeight||document.documentElement.clientHeight;
		return (lastBoxH<scrollTop+winH)?true:false
	}
</script>
<div id="main">
	<div class="box">
		<div class="pic"><img src="/mod/pinterest/css3/images/p_00.jpg" alt=""></div>
	</div>
	<div class="box">
		<div class="pic"><img src="/mod/pinterest/css3/images/p_01.jpg" alt=""></div>
	</div>
	<div class="box">
		<div class="pic"><img src="/mod/pinterest/css3/images/p_02.jpg" alt=""></div>
	</div>
	<div class="box">
		<div class="pic"><img src="/mod/pinterest/css3/images/p_03.jpg" alt=""></div>
	</div>
	<div class="box">
		<div class="pic"><img src="/mod/pinterest/css3/images/p_04.jpg" alt=""></div>
	</div>
	<div class="box">
		<div class="pic"><img src="/mod/pinterest/css3/images/p_05.jpg" alt=""></div>
	</div>
	<div class="box">
		<div class="pic"><img src="/mod/pinterest/css3/images/p_06.jpg" alt=""></div>
	</div>
	<div class="box">
		<div class="pic"><img src="/mod/pinterest/css3/images/p_07.jpg" alt=""></div>
	</div>
	<div class="box">
		<div class="pic"><img src="/mod/pinterest/css3/images/p_08.jpg" alt=""></div>
	</div>
	<div class="box">
		<div class="pic"><img src="/mod/pinterest/css3/images/p_09.jpg" alt=""></div>
	</div>
	<div class="box">
		<div class="pic"><img src="/mod/pinterest/css3/images/p_010.jpg" alt=""></div>
	</div>
	<div class="box">
		<div class="pic"><img src="/mod/pinterest/css3/images/p_011.jpg" alt=""></div>
	</div>
	<div class="box">
		<div class="pic"><img src="/mod/pinterest/css3/images/p_012.jpg" alt=""></div>
	</div>
	<div class="box">
		<div class="pic"><img src="/mod/pinterest/css3/images/p_013.jpg" alt=""></div>
	</div>
	<div class="box">
		<div class="pic"><img src="/mod/pinterest/css3/images/p_014.jpg" alt=""></div>
	</div>
	<div class="box">
		<div class="pic"><img src="/mod/pinterest/css3/images/p_015.jpg" alt=""></div>
	</div>
	<div class="box">
		<div class="pic"><img src="/mod/pinterest/css3/images/p_016.jpg" alt=""></div>
	</div>
	<div class="box">
		<div class="pic"><img src="/mod/pinterest/css3/images/p_017.jpg" alt=""></div>
	</div>
	<div class="box">
		<div class="pic"><img src="/mod/pinterest/css3/images/p_018.jpg" alt=""></div>
	</div>
	<div class="box">
		<div class="pic"><img src="/mod/pinterest/css3/images/p_019.jpg" alt=""></div>
	</div>
</div>